<!-- /*
* Template Name: Learner
* Template Author: Untree.co
* Tempalte URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Untree.co">
  <link rel="shortcut icon" href="favicon.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />

  <link href="https://fonts.googleapis.com/css2?family=Display+Playfair:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">


  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/animate.min.css">
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">
  <link rel="stylesheet" href="css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="fonts/icomoon/style.css">
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
  <link rel="stylesheet" href="css/aos.css">
  <link rel="stylesheet" href="css/style.css">

  <title>StudNtic</title>
</head>

<body>

  <div class="site-mobile-menu">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>


  
  <nav class="site-nav mb-5">
    <div class="pb-2 top-bar mb-3">
      <div class="container">
        <div class="row align-items-center">
    
            <div class="col-6 col-lg-9">
                <a href="#" class="small mr-3"><span class="icon-question-circle-o mr-2"></span> <span class="d-none d-lg-inline-block">Have a questions?</span></a> 
                <a href="#" class="small mr-3"><span class="icon-phone mr-2"></span> <span class="d-none d-lg-inline-block">10 20 123 456</span></a> 
                <a href="#" class="small mr-3"><span class="icon-envelope mr-2"></span> <span class="d-none d-lg-inline-block">info@mydomain.com</span></a> 
            </div>
    
            <div class="col-6 col-lg-3 text-right" id="authLinks">
                <a href="login.html" class="small mr-3">
                    <span class="icon-lock"></span>
                    Log In
                </a>
                <a href="register.html" class="small">
                    <span class="icon-person"></span>
                    Register
                </a>
            </div>
    
            <div class="col-6 col-lg-3 text-right d-none" id="profileLink">
                <a href="profile.html" class="small">
                    <span class="icon-user"></span>
                    Profile
                </a>
                <a href="#" class="small" id="logoutBtn">
                    <span class=""></span>
                    Logout
                </a>
            </div>
    
        </div>
    </div>
    <div class="sticky-nav js-sticky-header">
      <div class="container position-relative">
        <div class="site-navigation text-center">
          <a href="index.html" class="logo menu-absolute m-0">StudNtic<span class="text-primary">.</span></a>
      
          <ul class="js-clone-nav d-none d-lg-inline-block site-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="news.html">News</a></li>
            <li><a href="about.html">Events</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li id="myTicketsLink" class="d-none"><a href="ticket.html">My Tickets</a></li>
        </ul>
      
          <a href="#" class="btn-book btn btn-secondary btn-sm menu-absolute">Enroll Now</a>
      
          <a href="#" class="burger ml-auto float-right site-menu-toggle js-menu-toggle d-inline-block d-lg-none light" data-toggle="collapse" data-target="#main-navbar">
              <span></span>
          </a>
      </div>
      </div>
    </div>
  </nav>
  

  <div class="untree_co-hero overlay" style="background-image: url('images/img-school-1-min.jpg');">
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-12">
          <div class="row justify-content-center ">
            <div class="col-lg-6 text-center ">
              <h1 class="mb-4 heading text-white" data-aos="fade-up" data-aos-delay="100">Our Events</h1>
              <div class="mb-5 text-white desc mx-auto" data-aos="fade-up" data-aos-delay="200">
                <p>We Have Many Events </p>
              </div>

              <p class="mb-0" data-aos="fade-up" data-aos-delay="300"><a href="#" class="btn btn-secondary">Explore Our Events</a></p>

            </div>


          </div>

        </div>

      </div> <!-- /.row -->
    </div> <!-- /.container -->

  </div> <!-- /.untree_co-hero -->




  <div class="services-section">
    <div class="container">
      <div id="eventCards" class="row"></div>

    </div>
  </div>


    <div id="overlayer"></div>
    <div class="loader">
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>

    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/custom.js"></script>
    <script src="auth.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Check if accessToken is stored
        const accessToken = localStorage.getItem("accessToken");
      
        // If accessToken is found, show profile link and hide login and register links
        if (accessToken) {
          document.getElementById("authLinks").classList.add("d-none");
          document.getElementById("profileLink").classList.remove("d-none");
        }
      });
      document.addEventListener("DOMContentLoaded", function() {
        // Function to handle logout
        function logout() {
            // Remove the access token from local storage
            localStorage.removeItem("accessToken");
    
            // Redirect the user to the login page
            window.location.href = "login.html";
        }
    
        // Check if accessToken is stored
        const accessToken = localStorage.getItem("accessToken");
    
        // If accessToken is found, show profile link and logout button, hide login and register links
        if (accessToken) {
            document.getElementById("authLinks").classList.add("d-none");
            document.getElementById("profileLink").classList.remove("d-none");
        }
    
        // Add event listener to the logout button
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
            logoutBtn.addEventListener("click", logout);
        }
    });
    // Select the div where the event cards will be displayed
const eventCards = document.getElementById('eventCards');

// Fetch the data from the endpoint
fetch('http://127.0.0.1:8000/get_events/')
  .then(response => response.json())
  .then(data => {
    // Iterate over the fetched data
    data.forEach(event => {
      // Create a card element for each event
      const card = document.createElement('div');
      card.classList.add('col-md-4', 'mb-4');

      card.innerHTML = `
        <div class="card" style="border-radius: 15px;">
          <img src="http://127.0.0.1:8000/${event.image}/" class="card-img-top" alt="Event Image">
          <div class="card-body">
            <h5 class="card-title">${event.title}</h5>
            <p class="card-text">${event.description}</p>
            <p class="card-text">Number of Participants: ${event.number}</p>
            <button class="btn btn-primary enroll-btn" data-event-id="${event.id}">Enroll</button>
          </div>
        </div>
      `;

      // Append the card to the eventCards div
      eventCards.appendChild(card);
    });

    // Add event listener to enroll buttons
    const enrollButtons = document.querySelectorAll('.enroll-btn');
    enrollButtons.forEach(button => {
      button.addEventListener('click', enrollUser);
    });
  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });

// Function to handle enrolling a user
function enrollUser(event) {
  const eventId = event.target.dataset.eventId;
  
  // Check if the user is authenticated
  const accessToken = localStorage.getItem("accessToken");
  if (!accessToken) {
    console.log("User is not authenticated. Redirect to login page or display a message.");
    return;
  }

  // Perform enrollment logic here
  fetch(`http://127.0.0.1:8000/enroll_event/${eventId}/`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${accessToken}`
    }
  })
  .then(response => {
    if (response.status === 201) {
      // Update the button appearance and disable it
      const enrollButton = event.target;
      enrollButton.textContent = 'Enrolled';
      enrollButton.classList.remove('btn-primary');
      enrollButton.classList.add('btn-secondary', 'disabled');
      enrollButton.disabled = true;
      console.log('User enrolled successfully');
    } else if (response.status === 400) {
      // Update the button appearance to indicate the user already exists
      const enrollButton = event.target;
      enrollButton.textContent = 'Enrolled';
      enrollButton.classList.remove('btn-primary');
      enrollButton.classList.add('btn-secondary', 'disabled');
      enrollButton.disabled = true;
      console.log('User already exists for this event');
    } else {
      throw new Error('Failed to enroll user');
    }
  })
  .catch(error => {
    console.error('Error enrolling user:', error);
    // Optionally, you can display an error message to the user
  });
}

    </script>
    <script src="verfify.js"></script>
  </body>

  </html>
